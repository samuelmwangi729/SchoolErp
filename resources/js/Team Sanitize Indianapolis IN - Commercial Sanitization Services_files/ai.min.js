function SPAI(){}SPAI.prototype={stop:1e5,fancyboxId:"",fancyboxHooked:"none",mutationsCount:0,mutationsList:{},timeOutHandle:false,mutationsLastProcessed:0,mutationObserver:false,intersectionObserver:false,intersectionMargin:500,initialized:false,bodyHandled:false,bodyCount:0,supportsWebP:false,urlRegister:[],callbacks:[],sniperOn:false,debugInfo:{log:""},loadTs:Date.now()};SPAI.prototype.init=function(){if(typeof window.IntersectionObserver!=="function"){jQuery.getScript(spai_settings.plugin_url+"/js/intersection.min.js?"+spai_settings.version,ShortPixelAI.setupIntersectionObserverAndParse)}else{ShortPixelAI.setupIntersectionObserverAndParse()}};SPAI.prototype.record=function(e,t,r){if(spai_settings.debug){switch(e){case"count":if(typeof ShortPixelAI.debugInfo[t]==="undefined")ShortPixelAI.debugInfo[t]=0;ShortPixelAI.debugInfo[t]+=r;break;case"log":case"logX":if(typeof ShortPixelAI.debugInfo[t]==="undefined")ShortPixelAI.debugInfo[t]="";ShortPixelAI.debugInfo[t]+=(new Date).getTime()+" - "+(e==="log"?r:ShortPixelAI.xpath(r))+"\n"}}};SPAI.prototype.log=function(e){var t=Date.now()-ShortPixelAI.loadTs;var r=t+"ms - "+e;if(t<2e3){ShortPixelAI.debugInfo["log"]+=r+"\n";return}if(ShortPixelAI.debugInfo["log"]!==""){console.log(ShortPixelAI.debugInfo["log"]);ShortPixelAI.debugInfo["log"]=""}console.log(r)};SPAI.prototype.handleBody=function(){var e=jQuery("body");ShortPixelAI.bodyCount=1;try{ShortPixelAI.handleUpdatedImageUrls(true,e,true,false);ShortPixelAI.bodyHandled=true}catch(e){if(e=="defer_all"&&ShortPixelAI.bodyCount<20){setTimeout(ShortPixelAI.handleBody,20*ShortPixelAI.bodyCount);ShortPixelAI.bodyCount++}else{spai_settings.debug&&ShortPixelAI.log("handleBody - error "+e);throw e}}};SPAI.prototype.handleUpdatedImageUrlsWithRetry=function(t,r,i,o){try{ShortPixelAI.handleUpdatedImageUrls(t,r,i,o)}catch(e){if(e=="defer_all"&&ShortPixelAI.bodyCount<30){spai_settings.debug&&ShortPixelAI.log("handleUpdatedImageUrlsWRetry - DEFER ALL");setTimeout(function(){ShortPixelAI.handleUpdatedImageUrls(t,r,i,o)},20*ShortPixelAI.bodyCount);ShortPixelAI.bodyCount++}else{spai_settings.debug&&ShortPixelAI.log("handleUpdatedImageUrlsWRetry - error "+e.description);throw e}}};SPAI.prototype.handleUpdatedImageUrls=function(e,t,r,i){ShortPixelAI.record("count","observedMutations",1);if(ShortPixelAI.observedMutations>ShortPixelAI.stop)return;ShortPixelAI.record("count","handledMutations",1);if(!e&&!ShortPixelAI.bodyHandled){return}if(t.is("img,amp-img")){ShortPixelAI.updateImageUrl(t,r,i);return}jQuery("img,amp-img",t).each(function(){var e=jQuery(this);ShortPixelAI.updateImageUrl(e,r,i)});var o=spai_settings.affected_tags!=="{{SPAI-AFFECTED-TAGS}}"?JSON.parse(spai_settings.affected_tags):typeof spai_affectedTags!=="undefined"?JSON.parse(spai_affectedTags):{};if(i){for(var a in o){if(t.is(a)){ShortPixelAI.updateDivUrl(t,r,i);break}}}var n="";for(var a in o){n+=","+a}n=n.replace(/^,/,"");jQuery(n,t).each(function(){var e=jQuery(this);ShortPixelAI.updateDivUrl(e,r,i)});ShortPixelAI.updateAHrefForIntegration("CORE",t,"a.media-gallery-link");ShortPixelAI.updateAHrefForIntegration("envira",t,"a.envira-gallery-link");ShortPixelAI.updateAHrefForIntegration("modula",t,"div.modula-gallery a[data-lightbox]");ShortPixelAI.updateAHrefForIntegration("elementor-addons",t,"div.eael-filter-gallery-wrapper a.eael-magnific-link");ShortPixelAI.updateAHrefForIntegration("elementor",t,"a[data-elementor-open-lightbox]");ShortPixelAI.updateAHrefForIntegration("viba-portfolio",t,"a.viba-portfolio-media-link");if(spai_settings.active_integrations["wp-bakery"]){jQuery("span.dima-testimonial-image",t).each(function(){ShortPixelAI.updateWpBakeryTestimonial(jQuery(this))})}if(spai_settings.active_integrations["social-pug"]){jQuery("a.dpsp-pin-it-button",t).each(function(){var e=jQuery(this);var i=false;e.attr("href",e.attr("href").replace(/media=(data:image\/svg\+xml;.*)&url=/,function(e,t,r){i=true;return"media="+ShortPixelAI.parsePseudoSrc(t).src+"&url="}));if(!i){var t=spai_settings.api_url.substr(0,spai_settings.api_url.lastIndexOf("/")+1).replace("/","\\/")+"[^\\/]+\\/";e.attr("href",e.attr("href").replace(new RegExp(t),""))}})}ShortPixelAI.updateAHrefForIntegration("foo",t,"div.fg-item a.fg-thumb");if(spai_settings.active_integrations.nextgen){jQuery("a.ngg-fancybox",t).each(function(){var e=jQuery(this);if(!ShortPixelAI.isFullPseudoSrc(e.attr("href"))){return}var t=ShortPixelAI.parsePseudoSrc(e.attr("href"));e.attr("href",ShortPixelAI.composeApiUrl(false,t.src,"DEFER",false));e.mousedown(function(){ShortPixelAI.fancyboxUpdateWidth(e);return true})})}};SPAI.prototype.updateImageUrl=function(t,i,o){if(!ShortPixelAI.containsPseudoSrc(t[0].outerHTML)){return}if(typeof t.attr("data-spai-upd")!=="undefined"){return}var r=ShortPixelAI.isExcluded(t);if(!(r&4)&&!o&&!ShortPixelAI.elementInViewport(t[0],ShortPixelAI.intersectionMargin)){ShortPixelAI.intersectionObserver.observe(t[0]);return}var e=0,a=0;if((r&3)==0){try{var n=ShortPixelAI.getSizesRecursive(t,i);e=Math.ceil(n.width);a=Math.ceil(n.height)}catch(e){if(!t[0].complete){throw"defer_all"}if(typeof e.type!=="undefined"&&e.type=="defer"&&i&&!(r&4)){spai_settings.debug&&ShortPixelAI.log("Defer "+e.cause+" "+ShortPixelAI.parsePseudoSrc(t[0].src).src);t.on("mouseover",function(){var e=jQuery(this);var t=e.width(),r=e.height();if(e.is(":visible")){ShortPixelAI.updateImageUrl(e,i,o)}});return}}}ShortPixelAI.record("count","modifiedImg",1);ShortPixelAI.record("logX","modifiedImgURL",t[0]);if(e&&t.attr("width")){t.attr("width",e)}if(a&&t.attr("height")){t.attr("height",a)}var s=!!n?e-n.padding:e;var l=!!n?a-n.padding_height:a;var d=ShortPixelAI.updateSrc(t,"src",s,l,(spai_settings.method=="src"||spai_settings.method=="both")&&(r&2)==0);ShortPixelAI.updateSrc(t,"data-src",false,false,(r&2)==0);ShortPixelAI.updateSrc(t,"data-large_image",false,false,(r&2)==0);if(spai_settings.active_integrations.envira){ShortPixelAI.updateSrc(t,"data-envira-src",false,false,(r&2)==0);ShortPixelAI.updateSrc(t,"data-safe-src",s,l,(r&2)==0)}if(spai_settings.active_integrations.foo){ShortPixelAI.updateSrc(t,"data-src-fg",s,l,(r&2)==0)}if(spai_settings.method=="src"){ShortPixelAI.removeSrcSet(t)}else{ShortPixelAI.updateSrcSet(t,e,d)}ShortPixelAI.elementUpdated(t,e)};SPAI.prototype.updateWpBakeryTestimonial=function(e){if(1==e.attr("data-spai-upd")){return}ShortPixelAI.updateAttr(e,"data-element-bg");var t=0,r=0,i=[];var o=ShortPixelAI.isExcluded(e);if((o&3)==0){try{i=ShortPixelAI.getSizesRecursive(e,hasMutationObserver);t=Math.ceil(i.width);r=Math.ceil(i.height)}catch(e){if(typeof e.type!=="undefined"&&e.type=="defer"&&hasMutationObserver&&!(o&4)){return}}}ShortPixelAI.updateInlineStyle(e,t,r,true);ShortPixelAI.elementUpdated(e,t)};SPAI.prototype.updateDivUrl=function(e,t,r){if(1==e.attr("data-spai-upd")){return}if(typeof e.attr("src")==="undefined"&&typeof e.attr("data-src")==="undefined"&&typeof e.attr("data-thumb")==="undefined"&&!ShortPixelAI.getBackgroundPseudoImage(e.attr("style"))){return}if(!r&&!ShortPixelAI.elementInViewport(e[0],ShortPixelAI.intersectionMargin)){ShortPixelAI.intersectionObserver.observe(e[0]);return}var i=0,o=0,a=[];var n=ShortPixelAI.isExcluded(e);if((n&3)==0){try{a=ShortPixelAI.getSizesRecursive(e,t);i=Math.ceil(a.width);o=Math.ceil(a.height)}catch(e){if(typeof e.type!=="undefined"&&e.type=="defer"&&t&&!(n&4)){return}}}ShortPixelAI.updateSrc(e,"src",i,o,(n&2)==0);ShortPixelAI.updateSrc(e,"data-src",i,o,(n&2)==0);ShortPixelAI.updateSrc(e,"data-thumb",false,false,(n&2)==0);ShortPixelAI.updateInlineStyle(e,i,o,true);ShortPixelAI.elementUpdated(e,i)};SPAI.prototype.updateAHref=function(e,t,r){ShortPixelAI.updateAttr(e,"href")};SPAI.prototype.updateAttr=function(e,t){if(1==e.attr("data-spai-upd")){return}if(typeof e.attr(t)==="undefined"){return}var r=ShortPixelAI.updateSrc(e,t,window.screen.availWidth,window.screen.availHeight,(ShortPixelAI.isExcluded(e)&2)==0,true);ShortPixelAI.elementUpdated(e,r.newWidth)};SPAI.prototype.isExcluded=function(e){var t=0;for(var r=0;r<spai_settings.eager_selectors.length;r++){var i=spai_settings.eager_selectors[r];try{if(e.is(i))t|=4}catch(e){spai_settings.debug&&ShortPixelAI.log("eager:"+e.message)}}for(var r=0;r<spai_settings.excluded_selectors.length;r++){var i=spai_settings.excluded_selectors[r];try{if(e.is(i))t|=2}catch(e){spai_settings.debug&&ShortPixelAI.log("excluded:"+e.message)}}for(var r=0;r<spai_settings.noresize_selectors.length;r++){var i=spai_settings.noresize_selectors[r];try{if(e.is(i))t|=1}catch(e){spai_settings.debug&&ShortPixelAI.log("noresize:"+e.message)}}return t};SPAI.prototype.updateAHrefForIntegration=function(e,t,r){if(e=="CORE"||spai_settings.active_integrations[e]){jQuery(r,t).each(function(){var e=jQuery(this);ShortPixelAI.updateAHref(e)})}};SPAI.prototype.setupDOMChangeObserver=function(){ShortPixelAI.mutationObserver=new MutationObserver(function(e){if(ShortPixelAI.sniperOn)return;e.forEach(function(e){if(e.type==="attributes"&&e.attributeName==="id"){return}if(e.addedNodes.length){for(var t=0;t<e.addedNodes.length;t++){try{ShortPixelAI.handleUpdatedImageUrls(false,jQuery(e.addedNodes[t]),true,false)}catch(e){if(e=="defer_all"){setTimeout(ShortPixelAI.handleBody,20*ShortPixelAI.bodyCount)}else{throw e}}}}if(e.type=="attributes"){var r=e.target.getAttribute("class");r=typeof r==="undefined"||r===null?"":r;if(e.target.nodeName==="BODY"&&ShortPixelAI.containsPseudoSrc(r)>0){return}if(jQuery(e.target).attr("id")=="fancybox-wrap"&&ShortPixelAI.fancyboxId!=ShortPixelAI.fancyboxHooked){ShortPixelAI.hookIntoFancybox(e.target)}else{if(ShortPixelAI.timeOutHandle){clearTimeout(ShortPixelAI.timeOutHandle);if((new Date).getTime()-ShortPixelAI.mutationsLastProcessed>100){ShortPixelAI.processMutations()}}else{ShortPixelAI.mutationsLastProcessed=(new Date).getTime()}ShortPixelAI.observedMutations++;ShortPixelAI.mutationsList[ShortPixelAI.xpath(e.target)]={target:e.target,time:(new Date).getTime()};ShortPixelAI.timeOutHandle=setTimeout(ShortPixelAI.processMutations,50)}}})});var e=document.querySelector("body");var t={attributes:true,childList:true,subtree:true,characterData:true};ShortPixelAI.mutationObserver.observe(e,t)};SPAI.prototype.processMutations=function(){var e=0;for(var t in ShortPixelAI.mutationsList){var r=jQuery(ShortPixelAI.mutationsList[t].target);if(ShortPixelAI.mutationsList[t].time+50>(new Date).getTime()){e++;continue}var i=r[0].outerHTML;if(r.length&&ShortPixelAI.containsPseudoSrc(i)>0){ShortPixelAI.handleUpdatedImageUrlsWithRetry(false,r,true,false);if(i.indexOf("background")>0){ShortPixelAI.updateInlineStyle(r,false,false,true)}}delete ShortPixelAI.mutationsList[t]}ShortPixelAI.mutationsLastProcessed=(new Date).getTime();if(e>0){ShortPixelAI.timeOutHandle=setTimeout(ShortPixelAI.processMutations,50)}};SPAI.prototype.setupIntersectionObserverAndParse=function(){var e={rootMargin:ShortPixelAI.intersectionMargin+"px",threshold:0};ShortPixelAI.intersectionObserver=new IntersectionObserver(function(e,r){e.forEach(function(e){if(e.isIntersecting){var t=jQuery(e.target);ShortPixelAI.handleUpdatedImageUrlsWithRetry(false,t,true,true);if(e.target.outerHTML.indexOf("background")>0){ShortPixelAI.updateInlineStyle(t,false,false,true)}r.unobserve(e.target)}else if(spai_settings.debug){var t=jQuery(e.target);ShortPixelAI.log(t[0].nodeName+" is NOT intersecting - "+ShortPixelAI.parsePseudoSrc(t[0].src).src)}})},e);jQuery("style").each(function(){var e=jQuery(this);try{var t=ShortPixelAI.replaceBackgroundPseudoSrc(e.html());if(t.replaced){e.html(t.text)}}catch(e){spai_settings.debug&&ShortPixelAI.log("error "+e.description)}});jQuery("style").each(function(){var t=jQuery(this);try{var e=ShortPixelAI.replaceBackgroundPseudoSrc(t.html());if(e.replaced){t.html(e.text)}}catch(e){spai_settings.debug&&ShortPixelAI.log("Error parsing styles: "+e.description+" (STYLE TAG: "+t.html()+")")}});if(!navigator.platform||!/iPad|iPhone|iPod/.test(navigator.platform)){for(var t in document.styleSheets){var r=document.styleSheets[t];try{for(var i in r.rules){var o=r.rules[i];if(typeof o.cssText!=="undefined"&&ShortPixelAI.containsPseudoSrc(o.cssText)>0){var a=ShortPixelAI.replaceBackgroundPseudoSrc(o.cssText);if(a.replaced){o.cssText=a.text;document.styleSheets[t].removeRule(i);document.styleSheets[t].insertRule(a.text,i)}}}}catch(e){}}}ShortPixelAI.handleBody();if(typeof window.MutationObserver!=="function"){jQuery.getScript(spai_settings.plugin_url+"/js/MutationObserver.min.js?"+spai_settings.version,ShortPixelAI.setupDOMChangeObserver)}else{ShortPixelAI.setupDOMChangeObserver()}};SPAI.prototype.replaceBackgroundPseudoSrc=function(s){var l=false;s.replace(/background(-image|)\s*:([^;]*[,\s]|\s*)url\(['"]?(data:image\/svg\+xml;u=[^'"\)]*?)(['"]?)\)/gm,function(e){var t=/background(-image|)\s*:([^;]*[,\s]|\s*)url\(['"]?(data:image\/svg\+xml;u=[^'"\)]*?)(['"]?)\)/m;var r=t.exec(e);var i=ShortPixelAI.parsePseudoSrc(r[3]);var o=window.screen.width;var a=spai_settings.backgrounds_max_width?spai_settings.backgrounds_max_width:99999;var n=ShortPixelAI.composeApiUrl(false,i.src,Math.min(i.origWidth,o,a),false);s=s.replace(r[3],n);l=true});return{text:s,replaced:l}};SPAI.prototype.elementInViewport=function(e,t){var r=e.getBoundingClientRect();return r.bottom+t>=0&&r.right+t>=0&&r.top-t<=(window.innerHeight||document.documentElement.clientHeight)&&r.left-t<=(window.innerWidth||document.documentElement.clientWidth)};SPAI.prototype.hookIntoFancybox=function(e){if(ShortPixelAI.fancyboxId.length==0||ShortPixelAI.fancyboxHooked!=="none"){return}var t=jQuery(e);var r=jQuery("a#fancybox-right",t);r.mousedown(function(e){var t=ShortPixelAI.fancyboxChangeId(1);var r=jQuery("div#"+t+" a.ngg-fancybox");if(r.length){ShortPixelAI.fancyboxUpdateWidth(r)}});var r=jQuery("a#fancybox-left",t);r.mousedown(function(e){var t=ShortPixelAI.fancyboxChangeId(-1);var r=jQuery("div#"+t+" a.ngg-fancybox");if(r.length){ShortPixelAI.fancyboxUpdateWidth(r)}});ShortPixelAI.fancyboxHooked=ShortPixelAI.fancyboxId};SPAI.prototype.fancyboxChangeId=function(e){var t=ShortPixelAI.fancyboxId.match(/(.*)([0-9]+)$/);return t[1]+(parseInt(t[2])+e)};SPAI.prototype.composeApiUrl=function(e,t,r,i){if(!t.match(/^http[s]{0,1}:\/\/|^\/\//)){if(t.startsWith("/")){var o=document.createElement("a");o.href=spai_settings.site_url;t=o.protocol+"//"+o.hostname+t}else{var a=window.location.href.split("#")[0].split("?")[0];if(!a.endsWith("/")){var n=a.split("/");n.pop();a=n.join("/")+"/"}t=a+t;if(t.indexOf("..")>0){var o=document.createElement("a");o.href=t;t=o.protocol+"//"+o.hostname+(o.pathname.startsWith("/")?"":"/")+o.pathname+o.search+o.hash}}}if(r>1&&r<99999){var o=document.createElement("a");o.href=t;var s=/(?:\.([^.\/\?]+))(?:$|\?.*)/.exec(t)[1];if(s==="svg"){r=i=0}}if(r>1&&r<99999){var l=typeof window.devicePixelRatio==="undefined"?1:window.devicePixelRatio;r=Math.round(r*l);i=i?Math.round(i*l):undefined;if(ShortPixelAI.urlRegister[t]===undefined||ShortPixelAI.urlRegister[t]<r){if(e){ShortPixelAI.urlRegister[t]=r}}else{i=i?Math.round(i*ShortPixelAI.urlRegister[t]/r):undefined;r=ShortPixelAI.urlRegister[t]}var d=spai_settings.api_url.replace("%WIDTH%",""+r+(i?"+h_"+i:""))}else{var d=spai_settings.api_url.replace("w_%WIDTH%"+spai_settings.sep,"");d=d.replace("w_%WIDTH%","")}d=d+(ShortPixelAI.supportsWebP?spai_settings.sep+"to_webp":"")+"/"+t;return d};SPAI.prototype.isFullPseudoSrc=function(e){return this.parsePseudoSrc(e).full};SPAI.prototype.containsPseudoSrc=function(e){return e.indexOf("data:image/svg+xml;")>=0};SPAI.prototype.parsePseudoSrc=function(e){var t={src:false,origWidth:0,origHeight:0,full:false},r=/([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/;if(typeof e==="undefined"||!this.containsPseudoSrc(e)){return t}var i,o,a;e=e.trim();if(typeof e==="string"){a=e.match(r);a=a.length>0?a[0]:undefined;if(typeof a==="string"){o=atob(a)}}try{if(typeof o==="string"){i=jQuery(o)}}catch(e){spai_settings.debug&&ShortPixelAI.log("svgDecoded: "+o);return t}if(i instanceof jQuery){var n={url:i.data("u"),width:i.data("w"),height:i.data("h")};t.src=n.url===undefined||n.url===""?t.src:ShortPixelAI.urldecode(n.url);if(t.src!==""&&typeof t.src==="string"){if(t.src.lastIndexOf("//",0)===0){t.src=window.location.protocol+t.src}}t.origWidth=n.width===undefined||n.width===""?t.origWidth:n.width;t.origHeight=n.height===undefined||n.height===""?t.origHeight:n.height;t.full=typeof t.src==="string"&&t.src!==""}return t};SPAI.prototype.updateSrc=function(e,t,r,i,o,a){var n=e.attr("data-spai-"+t+"-meta");if(typeof n==="undefined"){var n=e.attr(t);if(typeof n==="undefined"){return false}}var s=ShortPixelAI.parsePseudoSrc(n);var l=s?s.src:false;if(!l){return false}s.crop=false;if(typeof a==="undefined"||!a){if(i>s.origHeight*r/s.origWidth){if(spai_settings.crop==="1"){s.crop=true}else{r=Math.ceil(s.origWidth*i/s.origHeight)}}}else{if(i<s.origHeight*r/s.origWidth){r=Math.ceil(s.origWidth*i/s.origHeight)}}s.newWidth=s.origWidth>1?Math.min(s.origWidth,r):r;var d=o?ShortPixelAI.composeApiUrl(t=="src"&&e.is("img"),l,s.newWidth,s.crop?i:false):l;e.attr(t,d);e.removeAttr("data-spai-"+t+"-meta");return s};SPAI.prototype.updateSrcSet=function(e,t,r){var i=e.attr("srcset");var o=e.attr("sizes");var a=ShortPixelAI.parsePseudoSrcSet(i,o,t,r);if(a.srcSet.length){e.attr("srcset",a.srcSet)}if(a.sizes.length){e.attr("sizes",a.sizes)}};SPAI.prototype.parsePseudoSrcSet=function(e,t,r,i){var o="";var a="";if(e){var n=e.match(/[^\s,][^\s]+(\s+[0-9wpx]+\s*,?|\s*,|\s*$)/g);for(var s=0;s<n.length;s++){var l=n[s].replace(/,$/,"").trim();var d="";var u=l.split(/\s+/);if(this.isFullPseudoSrc(u[0])){var u=l.split(/\s+/);if(u.length>=2){var h=ShortPixelAI.parsePseudoSrc(u[0]);if(h.src){d=ShortPixelAI.composeApiUrl(false,h.src,false,false)+" "+u[1]}if(r==parseInt(u[1])){i=false}else if(i&&r<parseInt(u[1])){o+=ShortPixelAI.composeApiUrl(false,i.src,r,false)+" "+r+"w,";i=false}}}if(!d.length){d=l}o+=d+", "}o=o.replace(/,+\s+$/,"")}else if(i&&spai_settings.method=="srcset"&&r<i.origWidth*.9){o=ShortPixelAI.composeApiUrl(false,i.src,r,false)+" "+r+"w, "+i.src+" "+i.origWidth+"w";a=Math.ceil(100*r/i.origWidth)+"vw, 100vw"}return{srcSet:o,sizes:a}};SPAI.prototype.removeSrcSet=function(e){var t=e.attr("srcset");if(typeof t!=="undefined"&&t.length){e.attr("srcset","");e.attr("sizes","")}};SPAI.prototype.updateInlineStyle=function(e,t,r,i){var o=e.attr("style");var a=ShortPixelAI.getBackgroundPseudoImage(e.attr("style"));var n=[];if(!a)return;for(var s=0;s<a.length;s++){var l=ShortPixelAI.parsePseudoSrc(a[s]);var d=l?l.src:false;if(d){while(d.charAt(0)=='"'){d=d.substring(1)}while(d.charAt(d.length-1)=='"'){d=d.substring(0,d.length-1)}}else{return false}var u=window.screen.width;var h=spai_settings.backgrounds_max_width?spai_settings.backgrounds_max_width:99999;var c=l.origWidth>0?l.origWidth:99999;var f=Math.min(c,u,t?t:99999,h);var p=window.screen.height;var g=l.origHeight>0?l.origHeight:99999;var I=g<99999?Math.min(g,p,t?t:99999):99999;var A=i?ShortPixelAI.composeApiUrl(false,d,f<99999?f:false,!!spai_settings.crop&&I<99999?I:false):d;e.attr("style",o.replace(a[s],A));n.push(l)}return n.length>0?n:false};SPAI.prototype.getBackgroundPseudoImage=function(e){if(typeof e==="undefined"||e.indexOf("background")<0){return false}var t=/(background-image|background)\s*:([^;]*[,\s]|\s*)url\(['"]?([^'"\)]*?)(['"]?)\)/gm,r,i=[];while((r=t.exec(e))!==null){if(!r||r.length<3){return false}if(r[3].indexOf("data:image")>=0){i.push(r[3])}}return i.length>0?i:false};SPAI.prototype.urldecode=function(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))};SPAI.prototype.getSizesRecursive=function(e,t){if(!e.is(":visible")&&t){throw{type:"defer",cause:"invisible"}}var r=window.getComputedStyle(e[0]);var i=r["width"];var o=r["height"];var a=Math.round(parseFloat(i));var n=Math.round(parseFloat(o));if(i=="0px"&&e[0].nodeName!=="A"){throw{type:"defer",cause:"width 0"}}if(i.slice(-1)=="%"){if(typeof e.parent()==="undefined")return{width:-1};var s=ShortPixelAI.getSizesRecursive(e.parent(),t);if(s==-1)return{width:-1,padding:0};a=s.width*a/100;if(o.slice(-1)=="%"){n=s.height*n/100}}else if(a<=1){if(typeof e.parent()==="undefined")return{width:-1,padding:0};var s=ShortPixelAI.getSizesRecursive(e.parent(),t);if(s.width==-1)return{width:-1,padding:0};a=s.width-s.padding-ShortPixelAI.percent2px(e.css("margin-left"),a)-ShortPixelAI.percent2px(e.css("margin-right"),a);n=s.height-s.padding_height-ShortPixelAI.percent2px(e.css("margin-top"),n)-ShortPixelAI.percent2px(e.css("margin-bottom"),n)}return{status:"success",width:a,height:n,padding:ShortPixelAI.percent2px(e.css("padding-left"),a)+ShortPixelAI.percent2px(e.css("padding-right"),a),padding_height:ShortPixelAI.percent2px(e.css("padding-top"),n)+ShortPixelAI.percent2px(e.css("padding-bottom"),n)}};SPAI.prototype.percent2px=function(e,t){return e.slice(-1)=="%"?t*parseInt(e)/100:parseInt(e)};SPAI.prototype.fancyboxUpdateWidth=function(e){var t=jQuery.extend({},jQuery.fn.fancybox.defaults,typeof e.data("fancybox")=="undefined"?{}:e.data("fancybox"));var r=[jQuery(window).width()-t.margin*2,jQuery(window).height()-t.margin*2,jQuery(document).scrollLeft()+t.margin,jQuery(document).scrollTop()+t.margin];var i=t.padding*2;var o=r[0]-i;var a=r[1]-i;var n=t.width/t.height;var s=o/a;var l=0;var d=0;if(n>s){l=o}else{d=a;l=Math.round(a*n)}l=l<700?Math.floor((l+49)/50)*50:Math.floor((l+99)/100)*100;var u=e.attr("href");if(u.indexOf("w_DEFER")>0){var h=u.replace("w_DEFER","w_"+l);e.attr("href",h)}else{var c=u.match(/\/w_([0-9]+),._/g);if(c!==null&&c[2]<l){var h=u.replace(/\/w_[0-9]+,/,"/w_"+l+",");e.attr("href",h)}else{return}}ShortPixelAI.fancyboxId=e.parent().parent().attr("id")};SPAI.prototype.xpath=function(t){if(typeof t=="string")return document.evaluate(t,document,null,0,null);if(!t||t.nodeType!=1)return"";if(t.id)return"//*[@id='"+t.id+"']";var e=[];try{e=t.parentNode===null||typeof t.parentNode.children==="undefined"?[]:[].filter.call(t.parentNode.children,function(e){return e.tagName==t.tagName})}catch(e){}return(t.parentNode===null?"":ShortPixelAI.xpath(t.parentNode)+"/")+t.tagName.toLowerCase()+(e.length>1?"["+([].indexOf.call(e,t)+1)+"]":"")};SPAI.prototype.registerCallback=function(e,t){ShortPixelAI.callbacks[e]=t};SPAI.prototype.elementUpdated=function(e,t){e.attr("data-spai-upd",t);if(typeof ShortPixelAI.callbacks["element-updated"]!=="undefined"){ShortPixelAI.callbacks["element-updated"](e)}};SPAI.prototype.getScroll=function(){if(window.pageYOffset!=undefined){return[pageXOffset,pageYOffset]}else{var e,t,r=document,i=r.documentElement,o=r.body;e=i.scrollLeft||o.scrollLeft||0;t=i.scrollTop||o.scrollTop||0;return[e,t]}};if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){t=t||0;return this.substr(t,e.length)===e}}var shortPixelAIonDOMLoadedTimeout=false;var shortPixelAIonDOMLoadedCounter=0;window.ShortPixelAI=new SPAI;function shortPixelAIonDOMLoaded(){if(ShortPixelAI.initialized)return;if(typeof spai_settings==="undefined"){if(shortPixelAIonDOMLoadedCounter>50){return}clearTimeout(shortPixelAIonDOMLoadedTimeout);shortPixelAIonDOMLoadedTimeout=setTimeout(shortPixelAIonDOMLoaded,shortPixelAIonDOMLoadedCounter>20?30:10);shortPixelAIonDOMLoadedCounter++;return}ShortPixelAI.initialized=true;if(spai_settings.webp=="1"&&self.createImageBitmap){var e=function(){var r={basic:"data:image/webp;base64,UklGRjIAAABXRUJQVlA4ICYAAACyAgCdASoCAAEALmk0mk0iIiIiIgBoSygABc6zbAAA/v56QAAAAA==",lossless:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="};return function(e){var t=jQuery.Deferred();jQuery("<img>").on("load",function(){if(this.width===2&&this.height===1){t.resolve()}else{t.reject()}}).on("error",function(){t.reject()}).attr("src",r[e||"basic"]);return t.promise()}}();e().then(function(){ShortPixelAI.supportsWebP=true;ShortPixelAI.init()},function(){ShortPixelAI.init()})}else{ShortPixelAI.init()}if(document.getElementById("shortpixel_ai_sniper")!==null){document.getElementById("shortpixel_ai_sniper").setAttribute("onclick","spaiSnip();return false;")}}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",function(){shortPixelAIonDOMLoaded()})}else{shortPixelAIonDOMLoaded()}